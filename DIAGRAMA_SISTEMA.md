# ğŸ“Š Diagrama Visual - Email Verification System

## 1. Arquitetura Geral

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APLICAÃ‡ÃƒO PET WELL TRACK                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FRONTEND       â”‚              â”‚  BACKEND                â”‚  â”‚
â”‚  â”‚  (React + TS)   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  (Node.js + Express)    â”‚  â”‚
â”‚  â”‚  Port: 8080     â”‚              â”‚  Port: 3000             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              â”‚                 â”‚
â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚                                    â–¼                    â–¼       â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                            â”‚  SQLite DB     â”‚  â”‚  Nodemailer  â”‚â”‚
â”‚                            â”‚  (cliente.db)  â”‚  â”‚  + Gmail     â”‚â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Fluxo de Registro

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USUÃRIO CLICA EM "REGISTRAR"                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  /registrar (Frontend)      â”‚
              â”‚  âœ“ ValidaÃ§Ã£o de domÃ­nio    â”‚
              â”‚  âœ“ Comprimento de password â”‚
              â”‚  âœ“ ConfirmaÃ§Ã£o de senha    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  POST /api/auth/register    â”‚
              â”‚  {                          â”‚
              â”‚    name,                    â”‚
              â”‚    email,                   â”‚
              â”‚    password                 â”‚
              â”‚  }                          â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  registerController (Backend)       â”‚
           â”‚  1. Valida domÃ­nio (8 permitidos)   â”‚
           â”‚  2. Verifica duplicata de email     â”‚
           â”‚  3. Hash password                   â”‚
           â”‚  4. Gera token (64 chars)           â”‚
           â”‚  5. INSERT no banco                 â”‚
           â”‚  6. Envia email                     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Database INSERT                    â”‚
           â”‚  INSERT INTO users (                â”‚
           â”‚    name,                            â”‚
           â”‚    email,                           â”‚
           â”‚    password_hash,                   â”‚
           â”‚    email_verified = 0,              â”‚
           â”‚    verification_token,              â”‚
           â”‚    verification_expires             â”‚
           â”‚  )                                  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Email Service (Nodemailer)         â”‚
           â”‚  1. Prepara template                â”‚
           â”‚  2. Gera link com token             â”‚
           â”‚  3. Conecta ao Gmail SMTP           â”‚
           â”‚  4. Envia para usuÃ¡rio              â”‚
           â”‚  5. Retorna message ID              â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Status 201 (Created)               â”‚
           â”‚  {                                  â”‚
           â”‚    success: true,                   â”‚
           â”‚    data: {id, name, email}          â”‚
           â”‚  }                                  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Frontend Redireciona para         â”‚
         â”‚ /verificacao-pendente            â”‚
         â”‚                                  â”‚
         â”‚ Mensagem: "Verifique seu email"  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Fluxo de VerificaÃ§Ã£o de Email

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USUÃRIO RECEBE EMAIL              â”‚
â”‚  Assunto: Verifique seu email      â”‚
â”‚  Link: /verificar-email/TOKEN      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  CLICA NO LINK       â”‚
      â”‚  (Abre no browser)   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Frontend (/verificar-email)    â”‚
      â”‚  1. Detecta token na URL        â”‚
      â”‚  2. Exibe "Verificando..."      â”‚
      â”‚  3. POST para backend           â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  POST /api/auth/verify-email/... â”‚
     â”‚  {token: "abc123..."}            â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  verifyEmailController              â”‚
     â”‚  1. Extrai token                    â”‚
     â”‚  2. Busca no banco                  â”‚
     â”‚  3. Valida expiraÃ§Ã£o                â”‚
     â”‚  4. UPDATE email_verified = 1       â”‚
     â”‚  5. DELETE token                    â”‚
     â”‚  6. Retorna 200                     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Database UPDATE                  â”‚
    â”‚  UPDATE users SET                 â”‚
    â”‚    email_verified = 1,            â”‚
    â”‚    verification_token = NULL,     â”‚
    â”‚    verification_expires = NULL    â”‚
    â”‚  WHERE id = ?                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Frontend Sucesso                 â”‚
    â”‚  âœ… Email verificado com sucesso! â”‚
    â”‚  Redirecionando em 2 segundos... â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Redireciona para /entrar        â”‚
    â”‚  (PÃ¡gina de Login)                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Fluxo de Login

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PÃGINA DE LOGIN (/entrar)       â”‚
â”‚  Email: ___________              â”‚
â”‚  Senha: ___________              â”‚
â”‚  [Entrar]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  POST /api/auth/login   â”‚
    â”‚  {email, password}      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  loginController                  â”‚
  â”‚  1. Busca usuÃ¡rio por email        â”‚
  â”‚     SELECT ... email_verified      â”‚
  â”‚  2. Valida se email_verified = 1   â”‚
  â”‚  3. Compara password com hash      â”‚
  â”‚  4. Gera JWT token                 â”‚
  â”‚  5. Retorna 200 + token            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ Se email nÃ£o verificado
           â”‚  â””â”€â”€â–º 403 Forbidden
           â”‚      "Email nÃ£o verificado"
           â”‚
           â”œâ”€ Se senha incorreta
           â”‚  â””â”€â”€â–º 401 Unauthorized
           â”‚      "Senha incorreta"
           â”‚
           â””â”€ Se OK
              â””â”€â”€â–º 200 OK
                  {
                    success: true,
                    token: "eyJhbGc...",
                    user: {id, name, email}
                  }
                  â”‚
                  â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Frontend salva JWT â”‚
           â”‚  localStorage.setItem(
           â”‚    'token',         â”‚
           â”‚    'eyJhbGc...'     â”‚
           â”‚  )                  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Redireciona para / â”‚
           â”‚  (Home Page)        â”‚
           â”‚  âœ… Autenticado!   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Estrutura do Banco de Dados

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TABLE: users (cliente.db)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  id               INTEGER PRIMARY KEY      â”‚
â”‚  name             TEXT NOT NULL            â”‚
â”‚  email            TEXT UNIQUE NOT NULL     â”‚
â”‚  password_hash    TEXT NOT NULL            â”‚
â”‚  email_verified   INTEGER DEFAULT 0        â”‚â—„â”€â”€â”€â”€ CRÃTICO!
â”‚  verification_token TEXT                   â”‚
â”‚  verification_expires INTEGER              â”‚
â”‚  role             TEXT DEFAULT 'client'    â”‚
â”‚  owner_id         INTEGER                  â”‚
â”‚  created_at       DATETIME                 â”‚
â”‚  updated_at       DATETIME                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Estados do email_verified:
  0 = NÃ£o verificado (inicial)
  1 = Verificado (apÃ³s clicar link)
```

---

## 6. Estados do Aplicativo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NOVO USUÃRIO       â”‚
â”‚  (nÃ£o registrado)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Clica "Registrar"
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REGISTRADO                      â”‚
â”‚  - email_verified = 0            â”‚
â”‚  - verification_token = ABC123   â”‚
â”‚  - Email enviado                 â”‚
â”‚  - Bloqueado de logar            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Clica link no email
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EMAIL VERIFICADO                â”‚
â”‚  - email_verified = 1            â”‚
â”‚  - verification_token = NULL     â”‚
â”‚  - Pode fazer login              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Faz login
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AUTENTICADO                     â”‚
â”‚  - JWT token salvo               â”‚
â”‚  - localStorage populado         â”‚
â”‚  - Acesso completo               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Fluxo de CÃ³digo Frontend

```
App.tsx
â”œâ”€â”€ Routes
â”‚   â”œâ”€â”€ Public: /
â”‚   â”œâ”€â”€ Public: /registrar
â”‚   â”‚   â””â”€â”€ Registrar.tsx
â”‚   â”‚       â””â”€â”€ POST /api/auth/register
â”‚   â”‚           â””â”€â”€ Redireciona: /verificacao-pendente
â”‚   â”œâ”€â”€ Public: /verificacao-pendente
â”‚   â”‚   â””â”€â”€ VerificacaoPendente.tsx
â”‚   â”‚       â”œâ”€â”€ Link: /verificar-email/:token
â”‚   â”‚       â””â”€â”€ Reenvio: /reenviar-verificacao
â”‚   â”œâ”€â”€ Public: /verificar-email/:token
â”‚   â”‚   â””â”€â”€ VerificarEmail.tsx
â”‚   â”‚       â””â”€â”€ POST /api/auth/verify-email/TOKEN
â”‚   â”‚           â””â”€â”€ Redireciona: /entrar
â”‚   â”œâ”€â”€ Public: /entrar
â”‚   â”‚   â””â”€â”€ Entrar.tsx
â”‚   â”‚       â””â”€â”€ POST /api/auth/login
â”‚   â”‚           â””â”€â”€ Redireciona: / (Home)
â”‚   â””â”€â”€ Protected: /dashboard
â”‚       â””â”€â”€ DashboardAdmin.tsx
â”‚           â”œâ”€â”€ Verifica JWT
â”‚           â”œâ”€â”€ Carrega dados protegidos
â”‚           â””â”€â”€ Logout
â”‚
AuthContext.tsx
â”œâ”€â”€ Gerencia JWT token
â”œâ”€â”€ Gerencia estado de usuÃ¡rio
â””â”€â”€ Verifica autenticaÃ§Ã£o
```

---

## 8. Endpoints da API

```
PUBLIC ENDPOINTS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/auth/register                â”‚
â”‚ Entrada:  {name, email, password}      â”‚
â”‚ SaÃ­da:    {success, data:{id, ...}}    â”‚
â”‚ Status:   201 Created                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/auth/login                   â”‚
â”‚ Entrada:  {email, password}            â”‚
â”‚ SaÃ­da:    {success, token, user}       â”‚
â”‚ Status:   200 OK / 403 Email not OK    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/auth/verify-email/:token     â”‚
â”‚ Entrada:  (token na URL)               â”‚
â”‚ SaÃ­da:    {success: true}              â”‚
â”‚ Status:   200 OK                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/auth/resend-verification     â”‚
â”‚ Entrada:  {email}                      â”‚
â”‚ SaÃ­da:    {success: true}              â”‚
â”‚ Status:   200 OK                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PROTECTED ENDPOINTS: (Requer JWT token)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/clientes/perfil               â”‚
â”‚ Entrada:  Authorization: Bearer TOKEN  â”‚
â”‚ SaÃ­da:    {success, data: usuario}     â”‚
â”‚ Status:   200 OK / 401 Unauthorized    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Timeline Esperado

```
T=0s   â†’ UsuÃ¡rio registra
T=1s   â†’ Email enviado
T=1-120s â†’ UsuÃ¡rio clica link (tÃ­pico 30s)
T=121s â†’ Email verificado
T=125s â†’ Login bem-sucedido
T=130s â†’ Dashboard carregado

Total: ~2 minutos (depende do usuÃ¡rio)
```

---

## 10. Fluxo de Erros

```
ERRO: "Email jÃ¡ existe"
â””â”€ Causa: Duplicata no banco
â””â”€ SoluÃ§Ã£o: Use outro email

ERRO: "DomÃ­nio nÃ£o permitido"
â””â”€ Causa: Email nÃ£o Ã© um dos 8 permitidos
â””â”€ SoluÃ§Ã£o: Use @gmail.com, @outlook.com, etc

ERRO: "Token expirado"
â””â”€ Causa: Link verificaÃ§Ã£o > 24h
â””â”€ SoluÃ§Ã£o: Clique em "Reenviar email"

ERRO: "Email nÃ£o verificado"
â””â”€ Causa: UsuÃ¡rio nÃ£o confirmou email
â””â”€ SoluÃ§Ã£o: Verificar inbox / spam

ERRO: "Senha incorreta"
â””â”€ Causa: Password mismatch
â””â”€ SoluÃ§Ã£o: Clique em "Esqueci senha"

ERRO: "ConexÃ£o recusada"
â””â”€ Causa: Backend nÃ£o estÃ¡ rodando
â””â”€ SoluÃ§Ã£o: `node index.js` em server/
```

---

## ğŸ“Š EstatÃ­sticas de ImplementaÃ§Ã£o

```
Arquivos Modificados:    11
Arquivos Criados:         8
Testes Criados:           4
DocumentaÃ§Ã£o:             4 arquivos
Linhas de CÃ³digo:         ~2000
Endpoints:                6
DomÃ­nios Suportados:      8
Tempo de ExpiraÃ§Ã£o:       24 horas
Taxa de Sucesso Testes:   100% âœ…
```

---

**Diagrama completo do sistema!** ğŸ‰
